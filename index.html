<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Th·ªè Nh√¢n √Åi ‚Äì Nh·∫≠t k√Ω Nh√¢n √°i 3-1-1</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: linear-gradient(135deg, #ffe9f0, #e3f6ff);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
    }
    .app {
      background: #ffffffdd;
      backdrop-filter: blur(10px);
      max-width: 560px;
      width: 100%;
      border-radius: 24px;
      box-shadow: 0 18px 35px rgba(0,0,0,0.15);
      padding: 20px 18px 16px;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }
    .header {
      display: flex;
      align-items: center;
      gap: 14px;
    }
    .avatar-wrap {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }
    .avatar {
      width: 72px; height: 72px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #fff, #ffd1e3);
      display: flex; align-items: center; justify-content: center;
      position: relative;
      box-shadow: 0 0 0 3px #fff, 0 10px 18px rgba(0,0,0,0.1);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .avatar::before, .avatar::after {
      content: "";
      position: absolute;
      width: 18px; height: 36px;
      background: #ffe6f2;
      border-radius: 50px;
      top: -28px;
      box-shadow: inset 0 0 0 2px #ffc1de;
    }
    .avatar::before { left: 10px; transform: rotate(-8deg); }
    .avatar::after  { right: 10px; transform: rotate(8deg); }
    .avatar span { font-size: 34px; }

    .avatar.speaking {
      animation: talkBounce 0.6s infinite alternate;
      box-shadow: 0 0 0 4px #fff, 0 14px 24px rgba(255,79,139,0.45);
    }
    @keyframes talkBounce {
      from { transform: translateY(0); }
      to   { transform: translateY(-4px) scale(1.03); }
    }
    .avatar-label {
      font-size: 11px;
      color: #ff4f8b;
      background: #fff0f6;
      padding: 2px 8px;
      border-radius: 999px;
    }

    .title-box { flex: 1; }
    .title { font-size: 19px; font-weight: 700; color: #ff4f8b; }
    .subtitle { font-size: 13px; color: #555; margin-top: 2px; }
    .tag {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 8px;
      border-radius: 999px;
      background: #fff4f9;
      color: #ff4f8b;
      font-size: 11px;
      margin-top: 4px;
    }

    .field {
      font-size: 13px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .field label {
      font-weight: 600;
      color: #444;
    }
    .field small {
      color: #777;
      font-size: 11px;
    }
    .field input,
    .field select {
      border-radius: 14px;
      border: 1px solid #e0e6ff;
      padding: 6px 10px;
      font-size: 13px;
      outline: none;
      background: #f7fbff;
    }

    .character-speech {
      background: #fff7fb;
      border-radius: 16px;
      padding: 8px 10px;
      border: 1px dashed #ffc6e0;
      font-size: 12px;
      color: #444;
      display: flex;
      gap: 6px;
      align-items: flex-start;
    }
    .character-speech span {
      font-size: 16px;
    }

    .chat {
      background: #fbfbff;
      border-radius: 18px;
      padding: 10px;
      border: 1px solid #edf1ff;
      display: flex;
      flex-direction: column;
      gap: 8px;
      max-height: 260px;
      overflow-y: auto;
      font-size: 13px;
    }
    .msg { display: flex; }
    .msg.me { justify-content: flex-end; }
    .bubble {
      max-width: 82%;
      padding: 8px 10px;
      border-radius: 14px;
      line-height: 1.4;
      word-wrap: break-word;
      white-space: pre-line;
    }
    .msg.me .bubble {
      background: #ffebf5;
      color: #333;
      border-bottom-right-radius: 4px;
    }
    .msg.bot .bubble {
      background: #eef5ff;
      color: #222;
      border-bottom-left-radius: 4px;
    }
    .msg.bot .bubble strong { color: #ff4f8b; }

    .hint {
      font-size: 11px;
      color: #777;
    }
    textarea {
      width: 100%;
      resize: none;
      border-radius: 14px;
      border: 1px solid #e0e6ff;
      padding: 8px 10px;
      min-height: 70px;
      font-size: 13px;
      outline: none;
    }

    .buttons {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    button, a.btn {
      border: none;
      border-radius: 14px;
      padding: 8px 14px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(135deg, #ff7bb5, #ff4f8b);
      color: #fff;
      box-shadow: 0 8px 14px rgba(255,79,139,0.4);
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      white-space: nowrap;
    }
    button.secondary, a.btn.secondary {
      background: #e7efff;
      color: #345;
      box-shadow: none;
      border: 1px solid #c9d7ff;
    }
    button:active, a.btn:active {
      transform: translateY(1px);
      box-shadow: 0 4px 10px rgba(255,79,139,0.35);
    }
    .form-note {
      font-size: 11px;
      color: #666;
    }
  </style>
</head>
<body>
<div class="app">

  <!-- HEADER -->
  <div class="header">
    <div class="avatar-wrap">
      <div class="avatar" id="bunnyAvatar"><span>üê∞</span></div>
      <div class="avatar-label">Th·ªè Nh√¢n √Åi</div>
    </div>
    <div class="title-box">
      <div class="title">Th·ªè Nh√¢n √Åi</div>
      <div class="subtitle">L·∫Øng nghe phi·∫øu 3‚Äì1‚Äì1 v√† g·ª≠i l·ªùi khen cho con üíõ</div>
      <div class="tag">3 l·ªùi c·∫£m ∆°n ‚Äì 1 vi·ªác t·ªët ‚Äì 1 l·ªùi y√™u th∆∞∆°ng</div>
    </div>
  </div>

  <!-- NH√ÇN V·∫¨T N√ìI -->
  <div class="character-speech" id="characterSpeech">
    <span>üí¨</span>
    <div id="currentSpeechText">
      Th·ªè ƒëang ·ªü ƒë√¢y ƒë·ªÉ l·∫Øng nghe c√¢u chuy·ªán Nh√¢n √Åi c·ªßa con. Con vi·∫øt xong phi·∫øu r·ªìi b·∫•m ‚ÄúG·ª≠i cho Th·ªè‚Äù nha üê∞üíó
    </div>
  </div>

  <!-- INPUT T√äN -->
  <div class="field">
    <label for="studentName">T√™n h·ªçc sinh</label>
    <input id="studentName" placeholder="V√≠ d·ª•: Tr·∫ßn Nguy√™n Kh√¥i..." />
  </div>

  <!-- INPUT L·ªöP -->
  <div class="field">
    <label for="className">L·ªõp</label>
    <small>Con ch·ªçn ƒë√∫ng l·ªõp c·ªßa m√¨nh nh√©.</small>
    <select id="className">
      <option value="">-- Ch·ªçn l·ªõp --</option>
      <option value="5/1">5/1</option>
      <option value="5/2">5/2</option>
      <option value="5/3">5/3</option>
      <option value="5/4">5/4</option>
      <option value="5/5">5/5</option>
    </select>
  </div>

  <!-- INPUT N·ªòI DUNG -->
  <div class="field">
    <label for="userInput">N·ªôi dung phi·∫øu nh√¢n √°i tu·∫ßn n√†y</label>
    <small>Con c√≥ th·ªÉ vi·∫øt 3 l·ªùi c·∫£m ∆°n ‚Äì 1 vi·ªác t·ªët ‚Äì 1 l·ªùi y√™u th∆∞∆°ng ho·∫∑c t√≥m t·∫Øt ƒëi·ªÅu t·ªët.</small>
    <textarea id="userInput" placeholder="V√≠ d·ª•: Con c·∫£m ∆°n..., Con ƒë√£ gi√∫p..., Con mu·ªën g·ª≠i l·ªùi y√™u th∆∞∆°ng t·ªõi..."></textarea>
  </div>

  <!-- KHUNG CHAT -->
  <div class="chat" id="chatBox">
    <div class="msg bot">
      <div class="bubble">
        <strong>Th·ªè Nh√¢n √Åi:</strong><br>
        Ch√†o con! Sau khi con vi·∫øt xong, b·∫•m ‚ÄúG·ª≠i cho Th·ªè‚Äù, th·ªè s·∫Ω ƒë·ªçc v√† g·ª≠i l·∫°i cho con l·ªùi khen ho·∫∑c ƒë·ªông vi√™n. üåü
      </div>
    </div>
  </div>

  <div class="hint">
    G·ª£i √Ω: c·∫£m ∆°n, gi√∫p ƒë·ª°, xin l·ªói, th∆∞∆°ng, y√™u, chia s·∫ª, an ·ªßi...
  </div>

  <!-- N√öT -->
  <div class="buttons">
    <button id="sendBtn">G·ª≠i cho Th·ªè</button>
    <a id="formBtn" class="btn secondary" href="#" target="_blank" style="display:none;">
      G·ª≠i phi·∫øu cho c√¥ (Google Form)
    </a>
  </div>

  <div class="form-note">
    B·∫•m ‚ÄúG·ª≠i phi·∫øu cho c√¥‚Äù sau khi Th·ªè ph·∫£n h·ªìi ƒë·ªÉ n·ªôp b√†i.
  </div>

</div>

<script>
  const chatBox   = document.getElementById("chatBox");
  const nameInput = document.getElementById("studentName");
  const classInput = document.getElementById("className");
  const textInput = document.getElementById("userInput");
  const sendBtn   = document.getElementById("sendBtn");
  const formBtn   = document.getElementById("formBtn");
  const bunnyAvatar = document.getElementById("bunnyAvatar");
  const currentSpeechText = document.getElementById("currentSpeechText");

  /* ‚≠ê LINK GOOGLE FORM C·ª¶A C√î HERE ‚≠ê */
  const GOOGLE_FORM_BASE = "https://docs.google.com/forms/d/e/1FAIpQLScFujTGwUCGm-ACOQrUbe4DgnfLXWYAK5C5H_TgwFzoW9rn8w/viewform";

  /* ======= GI·ªåNG N√ìI TH·ªé ======= */
  const synth = window.speechSynthesis;
  let bunnyVoice = null;

  function pickVietnameseVoice() {
    if (!synth) return null;
    const voices = synth.getVoices();
    return (
      voices.find(v => v.lang.toLowerCase().startsWith("vi")) ||
      voices[0] ||
      null
    );
  }

  function speakAsBunny(text) {
    if (!synth || !text) return;

    if (!bunnyVoice) {
      bunnyVoice = pickVietnameseVoice();
      if (!bunnyVoice) synth.onvoiceschanged = () => {
        bunnyVoice = pickVietnameseVoice();
      };
    }

    const utter = new SpeechSynthesisUtterance(text);
    utter.voice = bunnyVoice;
    utter.rate = 1.05;
    utter.pitch = 1.1;

    bunnyAvatar.classList.add("speaking");
    currentSpeechText.textContent = text;

    utter.onend = () => bunnyAvatar.classList.remove("speaking");

    synth.cancel();
    synth.speak(utter);
  }

  /* ======= HI·ªÇN TH·ªä TIN NH·∫ÆN ======= */
  function scrollToBottom(){ chatBox.scrollTop = chatBox.scrollHeight; }

  function addMessage(html, who="bot"){
    const msg = document.createElement("div");
    msg.className = "msg "+(who==="me" ? "me":"bot");
    const bubble = document.createElement("div");
    bubble.className = "bubble";
    bubble.innerHTML = html;
    msg.appendChild(bubble);
    chatBox.appendChild(msg);
    scrollToBottom();
  }

  /* ======= TH·ªé PH·∫¢N H·ªíI ======= */
  function makeBotReply(name, content){
    const t = content.toLowerCase();

    const hasThank = t.includes("c·∫£m ∆°n") || t.includes("cam on");
    const hasLove  = t.includes("th∆∞∆°ng") || t.includes("thuong") || t.includes("y√™u") || t.includes("yeu");
    const hasHelp  = t.includes("gi√∫p") || t.includes("giup") ||
                     t.includes("chia s·∫ª") || t.includes("chia se") ||
                     t.includes("nh·∫∑t") || t.includes("nhat");
    const hasSorry = t.includes("xin l·ªói") || t.includes("xin loi");

    const parts = [];

    parts.push(`Ch√†o ${name}! üê∞ Th·ªè ƒë√£ ƒë·ªçc xong phi·∫øu Nh√¢n √Åi c·ªßa con.`);

    if (hasHelp) {
      parts.push("Con ƒë√£ c√≥ h√†nh ƒë·ªông gi√∫p ƒë·ª° ho·∫∑c chia s·∫ª v·ªõi ng∆∞·ªùi kh√°c. Nh·ªØng vi·ªác l√†m nh∆∞ v·∫≠y khi·∫øn l·ªõp m√¨nh ·∫•m √°p h∆°n nhi·ªÅu. üåà");
    }
    if (hasThank) {
      parts.push("Th·ªè th√≠ch c√°ch con bi·∫øt n√≥i l·ªùi c·∫£m ∆°n. M·ªôt c√¢u c·∫£m ∆°n nh·ªè m√† mang theo r·∫•t nhi·ªÅu y√™u th∆∞∆°ng. üíê");
    }
    if (hasLove) {
      parts.push("Trong l·ªùi con vi·∫øt, th·ªè c·∫£m nh·∫≠n ƒë∆∞·ª£c nhi·ªÅu y√™u th∆∞∆°ng v√† s·ª± quan t√¢m. ƒêi·ªÅu ƒë√≥ th·∫≠t tuy·ªát v·ªùi. üíõ");
    }
    if (hasSorry) {
      parts.push("Con bi·∫øt nh·∫≠n l·ªói v√† n√≥i l·ªùi xin l·ªói. ƒêi·ªÅu ƒë√≥ cho th·∫•y con r·∫•t d≈©ng c·∫£m v√† bi·∫øt tr√°ch nhi·ªám. üíñ");
    }

    if (!hasHelp && !hasThank && !hasLove && !hasSorry) {
      parts.push("Tu·∫ßn n√†y con ch∆∞a ghi r√µ vi·ªác t·ªët, l·ªùi c·∫£m ∆°n hay l·ªùi y√™u th∆∞∆°ng. Tu·∫ßn sau con th·ª≠ ƒë·ªÉ √Ω m·ªôt vi·ªác nh·ªè con l√†m ƒë∆∞·ª£c r·ªìi ghi l·∫°i th·∫≠t c·ª• th·ªÉ nh√©. üå±");
    } else {
      if (!hasHelp) {
        parts.push("Tu·∫ßn t·ªõi, con th·ª≠ t√¨m m·ªôt vi·ªác t·ªët th·∫≠t c·ª• th·ªÉ ƒë·ªÉ gi√∫p ng∆∞·ªùi kh√°c nh√©. ü§ù");
      }
      if (!hasThank) {
        parts.push("Con c≈©ng th·ª≠ ch·ªçn m·ªôt ng∆∞·ªùi ƒë·ªÉ n√≥i l·ªùi c·∫£m ∆°n th·∫≠t l√≤ng nha. üåü");
      }
      if (!hasLove) {
        parts.push("N·∫øu ƒë∆∞·ª£c, con g·ª≠i th√™m m·ªôt l·ªùi y√™u th∆∞∆°ng ƒë·∫øn ba m·∫π, √¥ng b√†, th·∫ßy c√¥ ho·∫∑c b·∫°n b√®. üå∑");
      }
    }

    parts.push("Th·ªè lu√¥n s·∫µn s√†ng l·∫Øng nghe c√¢u chuy·ªán Nh√¢n √Åi c·ªßa con v√†o tu·∫ßn sau. üê∞‚ú®");

    const reply = parts.join(" ");
    addMessage("<strong>Th·ªè Nh√¢n √Åi:</strong><br>" + reply, "bot");
    speakAsBunny(reply);
  }

  /* ======= X·ª¨ L√ù G·ª¨I ======= */
  function handleSend(){
    const rawName = nameInput.value.trim();
    const className = classInput.value.trim();
    const nameToShow = (rawName || "con") + (className ? ` l·ªõp ${className}` : "");
    const content = textInput.value.trim();

    if (!content) return;

    addMessage(content, "me");
    makeBotReply(nameToShow, content);

    formBtn.style.display = "inline-flex";
    formBtn.href = GOOGLE_FORM_BASE;

    textInput.value = "";
  }

  sendBtn.addEventListener("click", handleSend);
  textInput.addEventListener("keydown", (e)=>{
    if(e.key==="Enter" && !e.shiftKey){
      e.preventDefault();
      handleSend();
    }
  });
</script>
</body>
</html>
