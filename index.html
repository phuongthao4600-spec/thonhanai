<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Th·ªè Nh√¢n √Åi ‚Äì Nh·∫≠t k√Ω 3-1-1</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: linear-gradient(135deg, #ffe9f0, #e3f6ff);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
    }
    .app {
      background: #ffffffdd;
      backdrop-filter: blur(10px);
      max-width: 600px;
      width: 100%;
      border-radius: 24px;
      box-shadow: 0 18px 35px rgba(0,0,0,0.15);
      padding: 20px 18px 18px;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }
    .header {
      display: flex;
      align-items: center;
      gap: 14px;
    }
    .avatar-wrap {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }
    .avatar {
      width: 82px; height: 82px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #fff, #ffd1e3);
      display: flex; align-items: center; justify-content: center;
      position: relative;
      box-shadow: 0 0 0 3px #fff, 0 10px 18px rgba(0,0,0,0.1);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .avatar::before, .avatar::after {
      content: "";
      position: absolute;
      width: 20px; height: 40px;
      background: #ffe6f2;
      border-radius: 50px;
      top: -32px;
      box-shadow: inset 0 0 0 2px #ffc1de;
    }
    .avatar::before { left: 12px; transform: rotate(-8deg); }
    .avatar::after  { right: 12px; transform: rotate(8deg); }
    .avatar span { font-size: 38px; }

    .avatar.speaking {
      animation: talkBounce 0.6s infinite alternate;
      box-shadow: 0 0 0 4px #fff, 0 14px 24px rgba(255,79,139,0.45);
    }
    @keyframes talkBounce {
      from { transform: translateY(0); }
      to   { transform: translateY(-4px) scale(1.03); }
    }
    .avatar-label {
      font-size: 11px;
      color: #ff4f8b;
      background: #fff0f6;
      padding: 2px 8px;
      border-radius: 999px;
    }

    .title-box { flex: 1; }
    .title { font-size: 20px; font-weight: 700; color: #ff4f8b; }
    .subtitle { font-size: 13px; color: #555; margin-top: 2px; }
    .tag {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 8px;
      border-radius: 999px;
      background: #fff4f9;
      color: #ff4f8b;
      font-size: 11px;
      margin-top: 4px;
    }

    .character-speech {
      background: #fff7fb;
      border-radius: 16px;
      padding: 8px 10px;
      border: 1px dashed #ffc6e0;
      font-size: 12px;
      color: #444;
      display: flex;
      gap: 6px;
      align-items: flex-start;
    }
    .character-speech span {
      font-size: 16px;
    }

    .field {
      font-size: 13px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .field label {
      font-weight: 600;
      color: #444;
    }
    .field small {
      color: #777;
      font-size: 11px;
    }
    .field input,
    .field select,
    .field textarea {
      border-radius: 14px;
      border: 1px solid #e0e6ff;
      padding: 6px 10px;
      font-size: 13px;
      outline: none;
      background: #f7fbff;
      resize: none;
    }
    .field textarea {
      min-height: 52px;
    }

    .chat {
      background: #fbfbff;
      border-radius: 18px;
      padding: 10px;
      border: 1px solid #edf1ff;
      display: flex;
      flex-direction: column;
      gap: 8px;
      max-height: 260px;
      overflow-y: auto;
      font-size: 13px;
    }
    .msg { display: flex; }
    .msg.me { justify-content: flex-end; }
    .bubble {
      max-width: 82%;
      padding: 8px 10px;
      border-radius: 14px;
      line-height: 1.4;
      word-wrap: break-word;
      white-space: pre-line;
    }
    .msg.me .bubble {
      background: #ffebf5;
      color: #333;
      border-bottom-right-radius: 4px;
    }
    .msg.bot .bubble {
      background: #eef5ff;
      color: #222;
      border-bottom-left-radius: 4px;
    }
    .msg.bot .bubble strong { color: #ff4f8b; }

    .hint {
      font-size: 11px;
      color: #777;
    }

    .buttons {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 2px;
    }
    button, a.btn {
      border: none;
      border-radius: 14px;
      padding: 8px 14px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(135deg, #ff7bb5, #ff4f8b);
      color: #fff;
      box-shadow: 0 8px 14px rgba(255,79,139,0.4);
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      white-space: nowrap;
    }
    button.secondary, a.btn.secondary {
      background: #e7efff;
      color: #345;
      box-shadow: none;
      border: 1px solid #c9d7ff;
    }
    button:active, a.btn:active {
      transform: translateY(1px);
      box-shadow: 0 4px 10px rgba(255,79,139,0.35);
    }
    .form-note {
      font-size: 11px;
      color: #666;
    }

    @media (max-width: 600px) {
      .app { padding: 16px 14px; }
      .title { font-size: 18px; }
      .avatar { width: 72px; height: 72px; }
    }
  </style>
</head>
<body>
<div class="app">
  <div class="header">
    <div class="avatar-wrap">
      <div class="avatar" id="bunnyAvatar"><span>üê∞</span></div>
      <div class="avatar-label">C√¥ Th·ªè Nh√¢n √Åi</div>
    </div>
    <div class="title-box">
      <div class="title">Th·ªè Nh√¢n √Åi</div>
      <div class="subtitle">C√¥ l·∫Øng nghe phi·∫øu 3‚Äì1‚Äì1 v√† g·ª≠i l·ªùi khen cho con üíõ</div>
      <div class="tag">3 l·ªùi c·∫£m ∆°n ‚Äì 1 vi·ªác t·ªët ‚Äì 1 l·ªùi y√™u th∆∞∆°ng</div>
    </div>
  </div>

  <div class="character-speech">
    <span>üí¨</span>
    <div id="currentSpeechText">
      H√¥m nay c√¥ Th·ªè s·∫Ω gi√∫p con xem con ƒë√£ ƒë·ªß 3 l·ªùi c·∫£m ∆°n, 1 vi·ªác t·ªët v√† 1 l·ªùi y√™u th∆∞∆°ng ch∆∞a nh√©. Con vi·∫øt xong r·ªìi b·∫•m ‚ÄúG·ª≠i cho Th·ªè‚Äù! üê∞
    </div>
  </div>

  <div class="field">
    <label for="studentName">T√™n h·ªçc sinh</label>
    <input id="studentName" placeholder="V√≠ d·ª•: Nguy·ªÖn Gia H√¢n..." />
  </div>

  <div class="field">
    <label for="className">L·ªõp</label>
    <small>Con ch·ªçn ƒë√∫ng l·ªõp c·ªßa m√¨nh nh√©.</small>
    <select id="className">
      <option value="">-- Ch·ªçn l·ªõp --</option>
      <option value="5/1">5/1</option>
      <option value="5/2">5/2</option>
      <option value="5/3">5/3</option>
      <option value="5/4">5/4</option>
      <option value="5/5">5/5</option>
      <option value="5/6">5/6</option>
      <option value="5/7">5/7</option>
      <option value="5/8">5/8</option>
      <option value="5/9">5/9</option>
      <option value="5/10">5/10</option>
      <option value="5/11">5/11</option>
      <option value="5/12">5/12</option>
      <option value="5/13">5/13</option>
      <option value="5/14">5/14</option>
      <option value="5/15">5/15</option>
    </select>
  </div>

  <div class="field">
    <label for="thanksInput">3 l·ªùi c·∫£m ∆°n</label>
    <small>Con c√≥ th·ªÉ c·∫£m ∆°n ba m·∫π, √¥ng b√†, th·∫ßy c√¥, b·∫°n b√®, h√†ng x√≥m...</small>
    <textarea id="thanksInput" placeholder="V√≠ d·ª•: Con c·∫£m ∆°n m·∫π v√¨..., con c·∫£m ∆°n b·∫°n v√¨..., con c·∫£m ∆°n c√¥ v√¨..."></textarea>
  </div>

  <div class="field">
    <label for="deedInput">1 vi·ªác t·ªët con ƒë√£ l√†m</label>
    <small>Vi·ªác nh·ªè c≈©ng ƒë∆∞·ª£c: gi√∫p ƒë·ª°, chia s·∫ª, nh∆∞·ªùng nh·ªãn, d·ªçn d·∫πp, an ·ªßi b·∫°n...</small>
    <textarea id="deedInput" placeholder="V√≠ d·ª•: Con ƒë√£ gi√∫p b·∫°n..., con ƒë√£ nh∆∞·ªùng..., con ƒë√£ l√†m..."></textarea>
  </div>

  <div class="field">
    <label for="loveInput">1 l·ªùi y√™u th∆∞∆°ng</label>
    <small>Con c√≥ th·ªÉ g·ª≠i l·ªùi y√™u th∆∞∆°ng t·ªõi ng∆∞·ªùi m√† con tr√¢n tr·ªçng nh·∫•t tu·∫ßn n√†y.</small>
    <textarea id="loveInput" placeholder="V√≠ d·ª•: Con mu·ªën g·ª≠i l·ªùi y√™u th∆∞∆°ng t·ªõi... v√¨..."></textarea>
  </div>

  <div class="chat" id="chatBox">
    <div class="msg bot">
      <div class="bubble">
        <strong>Th·ªè Nh√¢n √Åi:</strong><br>
        Ch√†o con! Con h√£y vi·∫øt ƒë·ªß 3 ph·∫ßn ·ªü tr√™n r·ªìi b·∫•m ‚ÄúG·ª≠i cho Th·ªè‚Äù. C√¥ s·∫Ω gi√∫p con nh·∫≠n ra ƒëi·ªÉm m·∫°nh v√† nh·∫Øc con ho√†n thi·ªán phi·∫øu Nh√¢n √Åi nh√©. üåü
      </div>
    </div>
  </div>

  <div class="hint">
    G·ª£i √Ω t·ª´ kh√≥a: c·∫£m ∆°n, gi√∫p ƒë·ª°, chia s·∫ª, xin l·ªói, th∆∞∆°ng, y√™u, an ·ªßi, l·∫Øng nghe...
  </div>

  <div class="buttons">
    <button id="sendBtn">G·ª≠i cho Th·ªè</button>
    <a id="formBtn" class="btn secondary" href="#" target="_blank" style="display:none;">
      G·ª≠i phi·∫øu cho c√¥ (Google Form)
    </a>
  </div>
  <div class="form-note">
    Th·ªè ch·ªâ gi√∫p con suy nghƒ© v√† nh·∫≠n x√©t. Khi b·∫•m ‚ÄúG·ª≠i phi·∫øu cho c√¥‚Äù, Google Form s·∫Ω m·ªü ra, con nh·ªõ b·∫•m n√∫t <strong>G·ª≠i</strong> trong Form ƒë·ªÉ c√¥ l∆∞u l·∫°i nh√©.
  </div>
</div>

<script>
  const chatBox   = document.getElementById("chatBox");
  const nameInput = document.getElementById("studentName");
  const classInput = document.getElementById("className");
  const thanksInput = document.getElementById("thanksInput");
  const deedInput   = document.getElementById("deedInput");
  const loveInput   = document.getElementById("loveInput");
  const sendBtn   = document.getElementById("sendBtn");
  const formBtn   = document.getElementById("formBtn");
  const bunnyAvatar = document.getElementById("bunnyAvatar");
  const currentSpeechText = document.getElementById("currentSpeechText");

  // ‚≠ê Link Google Form c·ªßa c√¥
  const GOOGLE_FORM_BASE =
    "https://docs.google.com/forms/d/e/1FAIpQLScFujTGwUCGm-ACOQrUbe4DgnfLXWYAK5C5H_TgwFzoW9rn8w/viewform";

  /* ====== GI·ªåNG C√î GI√ÅO ·∫§M √ÅP ====== */
  const synth = window.speechSynthesis;
  let teacherVoice = null;

  function pickWarmVietnameseVoice() {
    if (!synth) return null;
    const voices = synth.getVoices();
    const viVoices = voices.filter(v => v.lang.toLowerCase().startsWith("vi"));
    const femaleLike = viVoices.find(v =>
      /female|n·ªØ|nu|woman|girl/i.test(v.name)
    );
    return femaleLike || viVoices[0] || voices[0] || null;
  }

  function speakAsTeacher(text) {
    // lu√¥n c·∫≠p nh·∫≠t c√¢u n√≥i + cho th·ªè nh√∫n d√π m√°y kh√¥ng c√≥ voice
    currentSpeechText.textContent = text;
    bunnyAvatar.classList.add("speaking");
    setTimeout(() => bunnyAvatar.classList.remove("speaking"), 2600);

    if (!synth || !text) return;

    if (!teacherVoice) {
      teacherVoice = pickWarmVietnameseVoice();
      if (!teacherVoice) {
        synth.onvoiceschanged = () => {
          teacherVoice = pickWarmVietnameseVoice();
        };
      }
    }

    const utter = new SpeechSynthesisUtterance(text);
    if (teacherVoice) utter.voice = teacherVoice;
    utter.rate = 0.95;
    utter.pitch = 0.95;

    utter.onerror = () => {};
    synth.cancel();
    synth.speak(utter);
  }

  /* ====== CHAT ====== */
  function scrollToBottom() {
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  function addMessage(html, who = "bot") {
    const msg = document.createElement("div");
    msg.className = "msg " + (who === "me" ? "me" : "bot");
    const bubble = document.createElement("div");
    bubble.className = "bubble";
    bubble.innerHTML = html;
    msg.appendChild(bubble);
    chatBox.appendChild(msg);
    scrollToBottom();
  }

  /* ====== T·∫†O PH·∫¢N H·ªíI ====== */
  function makeBotReply(name, className, thanks, deed, love) {
    const hasThanks = thanks.trim().length > 0;
    const hasDeed  = deed.trim().length > 0;
    const hasLove  = love.trim().length > 0;

    const parts = [];

    const labelName = name || "con";
    const labelClass = className ? ` l·ªõp ${className}` : "";
    parts.push(`Ch√†o ${labelName}${labelClass}! C√¥ Th·ªè ƒë√£ ƒë·ªçc xong phi·∫øu Nh√¢n √Åi c·ªßa con r·ªìi.`);

    if (hasThanks && hasDeed && hasLove) {
      parts.push("Con ƒë√£ ho√†n th√†nh ƒë·ªß 3 ph·∫ßn: 3 l·ªùi c·∫£m ∆°n, 1 vi·ªác t·ªët v√† 1 l·ªùi y√™u th∆∞∆°ng. ƒêi·ªÅu ƒë√≥ cho th·∫•y tr√°i tim c·ªßa con r·∫•t nh√¢n √°i v√† bi·∫øt nghƒ© cho ng∆∞·ªùi kh√°c. üíõ");
      parts.push("C√¥ r·∫•t t·ª± h√†o v·ªÅ con. Tu·∫ßn n√†y con x·ª©ng ƒë√°ng nh·∫≠n m·ªôt t·∫•m <strong>Gi·∫•y khen Th·ªè Nh√¢n √Åi</strong> v√¨ ƒë√£ th·ª±c h√†nh l√≤ng bi·∫øt ∆°n, l√†m vi·ªác t·ªët v√† lan to·∫£ y√™u th∆∞∆°ng.");
      parts.push("Con h√£y ti·∫øp t·ª•c gi·ªØ th√≥i quen ƒë·∫πp n√†y trong nh·ªØng tu·∫ßn ti·∫øp theo nh√©. C√¥ tin r·∫±ng con s·∫Ω truy·ªÅn c·∫£m h·ª©ng cho nhi·ªÅu b·∫°n kh√°c trong l·ªõp. üåü");
    } else {
      if (!hasThanks && !hasDeed && !hasLove) {
        parts.push("Tu·∫ßn n√†y con ch∆∞a ghi r√µ l·ªùi c·∫£m ∆°n, vi·ªác t·ªët v√† l·ªùi y√™u th∆∞∆°ng. Kh√¥ng sao ƒë√¢u, ai c≈©ng c√≥ nh·ªØng tu·∫ßn kh·ªüi ƒë·ªông m√†. üå±");
      } else {
        parts.push("Con ƒë√£ c·ªë g·∫Øng vi·∫øt phi·∫øu Nh√¢n √Åi, c√¥ r·∫•t tr√¢n tr·ªçng ƒëi·ªÅu ƒë√≥. Tuy nhi√™n, ƒë·ªÉ phi·∫øu tr·ªçn v·∫πn h∆°n, con c·∫ßn ho√†n th√†nh th√™m m·ªôt v√†i ph·∫ßn n·ªØa nh√©.");
      }

      const missing = [];
      if (!hasThanks) missing.push("3 l·ªùi c·∫£m ∆°n");
      if (!hasDeed)  missing.push("1 vi·ªác t·ªët");
      if (!hasLove)  missing.push("1 l·ªùi y√™u th∆∞∆°ng");

      if (missing.length > 0) {
        const missingText = missing.join(", ");
        parts.push(`Ph·∫ßn con c√≤n thi·∫øu l√†: <strong>${missingText}</strong>. Con th·ª≠ nghƒ© xem trong tu·∫ßn n√†y m√¨nh ƒë√£ ƒë∆∞·ª£c ai gi√∫p ƒë·ª°, m√¨nh ƒë√£ l√†m vi·ªác t·ªët g√¨ ho·∫∑c con mu·ªën n√≥i l·ªùi y√™u th∆∞∆°ng v·ªõi ai nh√©.`);
      }

      if (hasThanks) {
        parts.push("Nh·ªØng l·ªùi c·∫£m ∆°n con ƒë√£ vi·∫øt cho th·∫•y con bi·∫øt tr√¢n tr·ªçng nh·ªØng ng∆∞·ªùi xung quanh, ƒë√≥ l√† ƒëi·ªÅu r·∫•t ƒë√°ng qu√Ω. üíê");
      }
      if (hasDeed) {
        parts.push("Vi·ªác t·ªët con l√†m, d√π nh·ªè th√¥i, c≈©ng ƒë√£ l√†m ng∆∞·ªùi kh√°c vui h∆°n. M·ªói vi·ªác t·ªët l√† m·ªôt h·∫°t gi·ªëng Nh√¢n √Åi ƒë∆∞·ª£c gieo xu·ªëng. üåà");
      }
      if (hasLove) {
        parts.push("L·ªùi y√™u th∆∞∆°ng con g·ª≠i ƒëi gi√∫p tr√°i tim c·ªßa ng∆∞·ªùi nh·∫≠n ·∫•m √°p h∆°n. ƒê√≥ c≈©ng l√† m·ªôt m√≥n qu√† r·∫•t ƒë·∫πp m√† kh√¥ng t·ªën ti·ªÅn ƒë√¢u. üíñ");
      }

      parts.push("Tu·∫ßn sau, con th·ª≠ ho√†n th√†nh ƒë·∫ßy ƒë·ªß c·∫£ 3 ph·∫ßn ƒë·ªÉ nh·∫≠n Gi·∫•y khen Th·ªè Nh√¢n √Åi nh√©. C√¥ lu√¥n tin l√† con l√†m ƒë∆∞·ª£c. C·ªë l√™n n√†o! üê∞‚ú®");
    }

    const replyText = parts.join(" ");
    const replyHtml = "<strong>Th·ªè Nh√¢n √Åi:</strong><br>" + replyText;

    addMessage(replyHtml, "bot");
    speakAsTeacher(replyText);
  }

  /* ====== X·ª¨ L√ù N√öT G·ª¨I ====== */
  function handleSend() {
    const rawName = (nameInput.value || "").trim();
    const className = (classInput.value || "").trim();
    const thanks = (thanksInput.value || "").trim();
    const deed   = (deedInput.value || "").trim();
    const love   = (loveInput.value || "").trim();

    if (!thanks && !deed && !love) return;

    const summary =
      "3 l·ªùi c·∫£m ∆°n:\n" + (thanks || "(ch∆∞a vi·∫øt)") +
      "\n\n1 vi·ªác t·ªët:\n" + (deed || "(ch∆∞a vi·∫øt)") +
      "\n\n1 l·ªùi y√™u th∆∞∆°ng:\n" + (love || "(ch∆∞a vi·∫øt)");
    addMessage(summary, "me");

    makeBotReply(rawName, className, thanks, deed, love);

    formBtn.style.display = "inline-flex";
    formBtn.href = GOOGLE_FORM_BASE;
  }

  sendBtn.addEventListener("click", handleSend);
</script>
</body>
</html>
